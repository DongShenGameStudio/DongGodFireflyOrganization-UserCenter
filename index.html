<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·ä¸­å¿ƒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* æ ·å¼éƒ¨åˆ†ä¿æŒä¸å˜ï¼Œä¸ä¹‹å‰ç›¸åŒ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary: #0d47a1;
            --primary-light: #5472d3;
            --primary-dark: #002171;
            --secondary: #ff6f00;
            --secondary-light: #ff9f40;
            --secondary-dark: #c43e00;
            --background: #f5f7fa;
            --card-bg: #ffffff;
            --text: #333333;
            --text-light: #666666;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--text);
            min-height: 100vh;
        }
        
        .top-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 70px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            padding: 0 25px;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo-img {
            height: 40px;
            width: auto;
            margin-right: 15px;
        }
        
        .header-title {
            font-size: 30px;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }
        
        .main-content {
            margin-top: 70px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 70px);
        }
        
        .cards-container {
            display: flex;
            gap: 25px;
            max-width: 1000px;
            width: 100%;
            justify-content: center;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            flex: 1;
            max-width: 400px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .card-header h2 {
            font-size: 20px;
            color: var(--primary);
        }
        
        .user-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .user-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        
        .user-name {
            font-size: 22px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .user-id {
            font-size: 16px;
            color: var(--text-light);
            margin-bottom: 25px;
        }
        
        .logout-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 25px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            font-size: 16px;
            width: 100%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .logout-btn:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .logout-btn i {
            margin-right: 8px;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
            color: white;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stat-info h3 {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        
        .stat-info p {
            font-size: 24px;
            font-weight: 700;
            color: var(--text);
        }
        
        .checkin-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 25px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            font-size: 16px;
            width: 100%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .checkin-btn:hover {
            background: #388e3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .checkin-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .checkin-btn i {
            margin-right: 8px;
        }
        
        .checkin-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }
        
        .checkin-status.success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .checkin-status.info {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
        }
        
        .checkin-status.error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        @media (max-width: 768px) {
            .top-header {
                padding: 0 15px;
            }
            
            .header-title {
                font-size: 50px;
            }
            
            .cards-container {
                flex-direction: column;
                align-items: center;
            }
            
            .card {
                width: 100%;
                max-width: 400px;
            }
        }
        
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-box {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
            padding: 30px;
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .login-logo {
            max-width: 200px;
            height: auto;
            margin: 0 auto 15px;
        }
        
        .login-header p {
            color: var(--text-light);
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .hidden {
            display: none;
        }
        
        .login-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .login-subtitle {
            font-size: 56px !important;
            font-weight: 600;
            color: var(--primary);
            margin: 8px 0 0 0;
        }
        
        /* æ–°å¢CNå¸å›¾æ ‡æ ·å¼ */
        .cn-coin-icon {
            position: relative;
            display: inline-block;
            font-size: 2.5em;
            color: white;
        }
        
        .cn-coin-icon .flag {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.55em;
            line-height: 1;
            background: none;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- ç™»å½•é¡µé¢ -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <img src="https://s21.ax1x.com/2025/11/26/pZABSfJ.png" alt="ä¸œç¥è¤ç«ç»„ç»‡" class="login-logo">
                <p class="login-subtitle">ç”¨æˆ·ä¸­å¿ƒ</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">æ‰‹æœºå·æˆ–é‚®ç®±ï¼š</label>
                    <input type="text" id="username" placeholder="è¯·è¾“å…¥æ‰‹æœºå·æˆ–é‚®ç®±" required>
                </div>
                
                <div class="form-group">
                    <label for="password">å¯†ç ï¼š</label>
                    <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                
                <button type="submit" class="login-btn">ç™»å½•</button>
            </form>
            
            <div id="loginMessage" class="hidden"></div>
        </div>
    </div>
    
    <!-- ç”¨æˆ·ä¸­å¿ƒé¡µé¢ -->
    <div id="dashboardPage" class="hidden">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <div class="top-header">
            <div class="logo">
                <img src="https://s21.ax1x.com/2025/11/26/pZABSfJ.png" alt="ä¸œç¥è¤ç«ç»„ç»‡" class="logo-img">
            </div>
            <div class="header-title">ç”¨æˆ·ä¸­å¿ƒ</div>
            <!-- å³ä¾§ç•™ç©ºä»¥ä¿æŒå¹³è¡¡ -->
            <div style="width: 40px;"></div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="cards-container">
                <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
                <div class="card user-card">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-name" id="userNickname">ä¸œç¥å·¥ä½œå®¤</div>
                    <div class="user-id">UID: <span id="userNumber">10005</span></div>
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>é€€å‡ºç™»å½•</span>
                    </button>
                </div>
                
                <!-- èµ„äº§å¡ç‰‡ -->
                <div class="card">
                    <div class="card-header">
                        <h2>èµ„äº§æ¦‚è§ˆ</h2>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">
                            <!-- æ–°çš„CNå¸å›¾æ ‡ -->
                            <span class="cn-coin-icon">
                                <i class="fa-solid fa-layer-group"></i>
                                <span class="flag">ğŸ‡¨ğŸ‡³</span>
                            </span>
                        </div>
                        <div class="stat-info">
                            <h3>CNå¸</h3>
                            <p id="userCurrency">8,888</p>
                        </div>
                    </div>
                </div>
                
                <!-- ç­¾åˆ°å¡ç‰‡ -->
                <div class="card">
                    <div class="card-header">
                        <h2>æ¯æ—¥ç­¾åˆ°</h2>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3>ä»Šæ—¥å·²ç­¾åˆ°</h3>
                            <p id="checkinStatus">æœªç­¾åˆ°</p>
                        </div>
                    </div>
                    <button class="checkin-btn" id="checkinBtn">
                        <i class="fas fa-check-circle"></i>
                        <span>ç«‹å³ç­¾åˆ°</span>
                    </button>
                    <div id="checkinMessage" class="checkin-status hidden"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è¿œç¨‹JSONæ–‡ä»¶åœ°å€
        const JSON_URLS = {
            beijingDate: "https://dongshengamestudio.github.io/DateSynchronizationAPIinChinaBeijing/DateSynchronizationAPIinChinaBeijing.json",
            phoneToNumber: "https://dongshengamestudio.github.io/DongGodNetworkTechnologyServiceAPI/UserMobilePhoneNumberCorrespondingNumberTable.json",
            emailToNumber: "https://dongshengamestudio.github.io/DongGodNetworkTechnologyServiceAPI/UserEmailAddressNumberToNumberTable.json",
            numberToPassword: "https://dongshengamestudio.github.io/DongGodNetworkTechnologyServiceAPI/Number-To-PasswordTable.json",
            numberToNickname: "https://dongshengamestudio.github.io/DongGodNetworkTechnologyServiceAPI/NicknameOfTheUserCorrespondingToTheNumber.json",
            numberToCurrency: "https://dongshengamestudio.github.io/DongGodNetworkTechnologyServiceAPI/ChineseCurrencyCorrespondingToTheNumber.json"
        };

        // ç”¨æˆ·æ•°æ®ç¼“å­˜
        let userData = null;
        
        // å®Œæ•´çš„51ä¸ªæ—¶é—´APIåˆ—è¡¨
        const TIME_APIS = [
            // å›½é™…æ ‡å‡†æ—¶é—´API (10ä¸ª)
            'https://worldtimeapi.org/api/timezone/Asia/Shanghai',
            'https://worldtimeapi.org/api/timezone/Asia/Tokyo',
            'https://worldtimeapi.org/api/timezone/Asia/Singapore',
            'https://worldtimeapi.org/api/timezone/UTC',
            'https://timeapi.io/api/Time/current/zone?timeZone=Asia/Shanghai',
            'https://timeapi.io/api/Time/current/zone?timeZone=UTC',
            'https://www.timeapi.io/api/Time/current/zone?timeZone=Asia/Tokyo',
            'https://time.is/',
            'https://time.akamai.com/',
            'https://www.ntp.org/',
            
            // ä¸­å›½æ—¶é—´API (10ä¸ª)
            'http://api.m.taobao.com/rest/api3.do?api=mtop.common.getTimestamp',
            'https://api.apiopen.top/api/getTime',
            'https://www.timestamp.cn/',
            'https://api.mytime.com/api/v1/current-time',
            'https://time.1234567.com.cn/',
            'https://quan.suning.com/getSysTime.do',
            'https://api.jisuapi.com/date/get',
            'https://api.haoshenqi.com/time',
            'https://api.help.bj.cn/apis/time',
            'https://api.xingzhige.com/API/time',
            
            // ä¸–ç•Œæ—¶é—´API (10ä¸ª)
            'https://worldclockapi.com/api/json/utc/now',
            'https://worldclockapi.com/api/json/cst/now',
            'https://worldclockapi.com/api/jsonp/cst/now?callback=time',
            'https://www.worldtimeserver.com/clocks/current_time.aspx',
            'https://timezonedb.com/api',
            'https://api.timezonedb.com/v2.1/get-time-zone',
            'https://timezoneapi.io/api/ip',
            'https://api.ipgeolocation.io/timezone',
            'https://timezoneapi.io/api/timezone',
            'https://api.abbreviations.com/timezone',
            
            // é‡‘èæ—¶é—´API (5ä¸ª)
            'https://api.coindesk.com/v1/bpi/currentprice.json',
            'https://api.polygon.io/v1/meta/symbols/AAPL/company',
            'https://api.twelvedata.com/time_series',
            'https://finnhub.io/api/v1/quote',
            'https://www.alphavantage.co/query',
            
            // å¤©æ°”APIï¼ˆåŒ…å«æ—¶é—´ä¿¡æ¯ï¼‰(5ä¸ª)
            'https://api.openweathermap.org/data/2.5/weather',
            'https://api.weatherapi.com/v1/current.json',
            'https://www.7timer.info/bin/api.pl',
            'https://api.weather.gov/points/39.9,-116.4',
            'https://api.weatherbit.io/v2.0/current',
            
            // å…¬å…±APIï¼ˆåŒ…å«æ—¶é—´æˆ³ï¼‰(5ä¸ª)
            'https://api.kanye.rest/',
            'https://api.chucknorris.io/jokes/random',
            'https://api.agify.io/',
            'https://api.genderize.io/',
            'https://api.nationalize.io/',
            
            // åœ°ç†ä½ç½®APIï¼ˆåŒ…å«æ—¶é—´ä¿¡æ¯ï¼‰(3ä¸ª)
            'https://ipapi.co/json/',
            'https://api.ipgeolocation.io/timezone',
            'https://ipinfo.io/json',
            
            // æ›´å¤šæ—¶é—´API (3ä¸ª)
            'https://dateandtime.asia/api',
            'https://time.services/api/now',
            'https://currenttimeapi.com/api'
        ];
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            const userInfo = localStorage.getItem('userInfo');
            
            if (userInfo) {
                // ç”¨æˆ·å·²ç™»å½•ï¼Œæ˜¾ç¤ºç”¨æˆ·ä¸­å¿ƒ
                const userData = JSON.parse(userInfo);
                showDashboard(userData);
            } else {
                // ç”¨æˆ·æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•é¡µé¢
                showLoginPage();
            }
            
            // ç™»å½•è¡¨å•æäº¤
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                document.getElementById('loginMessage').classList.remove('hidden');
                document.getElementById('loginMessage').className = 'login-message';
                document.getElementById('loginMessage').textContent = 'æ­£åœ¨éªŒè¯ç”¨æˆ·ä¿¡æ¯...';
                
                // ç™»å½•éªŒè¯
                verifyLogin(username, password);
            });
            
            // é€€å‡ºç™»å½•
            document.getElementById('logoutBtn').addEventListener('click', function() {
                localStorage.removeItem('userInfo');
                showLoginPage();
            });
            
            // ç­¾åˆ°æŒ‰é’®ç‚¹å‡»
            document.getElementById('checkinBtn').addEventListener('click', function() {
                handleCheckin();
            });
        });
        
        // æ˜¾ç¤ºç™»å½•é¡µé¢
        function showLoginPage() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('dashboardPage').classList.add('hidden');
        }
        
        // æ˜¾ç¤ºç”¨æˆ·ä¸­å¿ƒ
        function showDashboard(userData) {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
            document.getElementById('userNickname').textContent = userData.nickname;
            document.getElementById('userNumber').textContent = userData.number;
            document.getElementById('userCurrency').textContent = userData.currency.toLocaleString();
            
            // æ›´æ–°ç­¾åˆ°çŠ¶æ€
            updateCheckinStatus(userData);
        }
        
        // ä»è¿œç¨‹JSONè·å–åŒ—äº¬æ—¥æœŸ
        async function getBeijingDateFromRemoteJSON() {
            try {
                const response = await fetch(JSON_URLS.beijingDate, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    throw new Error('è¿œç¨‹JSONè¯·æ±‚å¤±è´¥');
                }
                
                const data = await response.json();
                
                // å‡è®¾JSONæ ¼å¼ä¸º { "date": "2024-01-01" } æˆ–ç±»ä¼¼æ ¼å¼
                if (data.date) {
                    console.log('ä»è¿œç¨‹JSONè·å–çš„æ—¥æœŸ:', data.date);
                    return data.date;
                } else {
                    throw new Error('è¿œç¨‹JSONæ ¼å¼ä¸æ­£ç¡®');
                }
            } catch (error) {
                console.error('ä»è¿œç¨‹JSONè·å–æ—¥æœŸå¤±è´¥:', error);
                throw new Error('è¿œç¨‹JSONè·å–æ—¥æœŸå¤±è´¥');
            }
        }
        
        // è·å–åŒ—äº¬æ—¶é—´ï¼ˆä¼˜å…ˆä½¿ç”¨è¿œç¨‹JSONï¼Œå¤±è´¥åä½¿ç”¨APIåˆ—è¡¨ï¼Œæœ€åä½¿ç”¨å¤‡ç”¨APIï¼‰
        async function getBeijingTimeFromAPIs() {
            try {
                // ä¼˜å…ˆä½¿ç”¨è¿œç¨‹JSONè·å–æ—¥æœŸ
                return await getBeijingDateFromRemoteJSON();
            } catch (error) {
                console.log('è¿œç¨‹JSONè·å–å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨æ—¶é—´API...');
                
                // éšæœºé€‰æ‹©10ä¸ªAPIè¿›è¡ŒéªŒè¯ï¼Œæé«˜æ€§èƒ½
                const selectedAPIs = [...TIME_APIS]
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 10);
                
                const promises = selectedAPIs.map(api => 
                    fetch(api, { 
                        method: 'GET',
                        mode: 'cors',
                        cache: 'no-cache'
                    }).then(response => {
                        if (!response.ok) throw new Error('APIè¯·æ±‚å¤±è´¥');
                        return response.text().then(text => {
                            try {
                                return JSON.parse(text);
                            } catch (e) {
                                return text;
                            }
                        });
                    }).then(data => {
                        // æ ¹æ®ä¸åŒAPIçš„å“åº”æ ¼å¼æå–æ—¶é—´
                        let timestamp;
                        
                        if (api.includes('worldtimeapi')) {
                            // worldtimeapi.org
                            return data.datetime.split('T')[0]; // è¿”å›æ—¥æœŸéƒ¨åˆ†
                        } else if (api.includes('taobao')) {
                            // æ·˜å®æ—¶é—´API
                            timestamp = parseInt(data.data.t);
                            return new Date(timestamp).toISOString().split('T')[0];
                        } else if (api.includes('apiopen.top')) {
                            // apiopen.top
                            return data.result.currentTime.split(' ')[0]; // è¿”å›æ—¥æœŸéƒ¨åˆ†
                        } else if (api.includes('timeapi.io')) {
                            // timeapi.io
                            return data.dateTime.split('T')[0]; // è¿”å›æ—¥æœŸéƒ¨åˆ†
                        } else if (api.includes('akamai')) {
                            // akamaiæ—¶é—´APIè¿”å›çš„æ˜¯æ—¶é—´æˆ³
                            return new Date().toISOString().split('T')[0]; // ä½¿ç”¨å½“å‰æ—¥æœŸä½œä¸ºå¤‡ç”¨
                        } else if (api.includes('coindesk')) {
                            // CoinDesk API
                            return data.time.updatedISO.split('T')[0];
                        } else {
                            // å…¶ä»–APIï¼Œä½¿ç”¨å“åº”æ—¶é—´ä½œä¸ºå‚è€ƒ
                            const responseDate = new Date();
                            return responseDate.toISOString().split('T')[0];
                        }
                    }).catch(error => {
                        console.warn(`API ${api} è¯·æ±‚å¤±è´¥:`, error);
                        return null;
                    })
                );
                
                const results = await Promise.allSettled(promises);
                const validDates = results
                    .filter(result => result.status === 'fulfilled' && result.value !== null)
                    .map(result => result.value);
                
                // å¦‚æœæ‰€æœ‰APIéƒ½å¤±è´¥äº†ï¼Œå°è¯•ä½¿ç”¨å¤‡ç”¨API
                if (validDates.length === 0) {
                    console.log('æ‰€æœ‰ä¸»è¦APIè¯·æ±‚å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨å¤‡ç”¨API...');
                    return getBeijingTimeFromBackupAPI();
                }
                
                // æ‰¾å‡ºæœ€å¸¸è§çš„æ—¥æœŸï¼ˆä¼—æ•°ï¼‰
                const dateCounts = {};
                validDates.forEach(date => {
                    dateCounts[date] = (dateCounts[date] || 0) + 1;
                });
                
                let mostCommonDate = null;
                let maxCount = 0;
                
                for (const [date, count] of Object.entries(dateCounts)) {
                    if (count > maxCount) {
                        mostCommonDate = date;
                        maxCount = count;
                    }
                }
                
                // å¦‚æœæœ€å¸¸è§çš„æ—¥æœŸæœ‰è¶³å¤Ÿå¤šçš„APIæ”¯æŒï¼ˆè‡³å°‘3ä¸ªï¼‰ï¼Œåˆ™è¿”å›è¯¥æ—¥æœŸ
                if (maxCount >= 3) {
                    return mostCommonDate;
                } else {
                    console.log('æ—¶é—´APIç»“æœä¸ä¸€è‡´ï¼Œå°è¯•ä½¿ç”¨å¤‡ç”¨API...');
                    return getBeijingTimeFromBackupAPI();
                }
            }
        }
        
        // ä½¿ç”¨å¤‡ç”¨APIè·å–åŒ—äº¬æ—¶é—´
        async function getBeijingTimeFromBackupAPI() {
            const params = {
                "id": "0a6a98cba40651e59d2b9aa4e8106d82",
                "key": "0a6a98cba40651e59d2b9aa4e8106d82",
                "type": "2"
            };
            
            const url = "https://cn.apihz.cn/api/time/getapi.php";
            
            try {
                const response = await fetch(url + '?' + new URLSearchParams(params), {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    throw new Error('å¤‡ç”¨APIè¯·æ±‚å¤±è´¥');
                }
                
                const data = await response.json();
                
                if (data.code === 200) {
                    // ä»è¿”å›çš„æ—¶é—´å­—ç¬¦ä¸²ä¸­æå–æ—¥æœŸéƒ¨åˆ†
                    // data.msg æ ¼å¼ä¸º "2024-01-01 12:00:00"
                    const datePart = data.msg.split(' ')[0];
                    console.log('å¤‡ç”¨APIè¿”å›çš„æ—¥æœŸ:', datePart);
                    return datePart;
                } else {
                    throw new Error('å¤‡ç”¨APIè¿”å›é”™è¯¯: ' + data.msg);
                }
            } catch (error) {
                console.error('å¤‡ç”¨APIè¯·æ±‚å¤±è´¥:', error);
                throw new Error('æ‰€æœ‰æ—¶é—´APIéƒ½è¯·æ±‚å¤±è´¥ï¼ŒåŒ…æ‹¬å¤‡ç”¨API');
            }
        }
        
        // æ›´æ–°ç­¾åˆ°çŠ¶æ€
        function updateCheckinStatus(userData) {
            const checkinStatus = document.getElementById('checkinStatus');
            const checkinBtn = document.getElementById('checkinBtn');
            const lastCheckinDate = userData.lastCheckinDate;
            
            // ä½¿ç”¨APIè·å–å½“å‰æ—¥æœŸ
            getBeijingTimeFromAPIs().then(todayDate => {
                console.log("ä»Šå¤©æ—¥æœŸ:", todayDate, "ä¸Šæ¬¡ç­¾åˆ°æ—¥æœŸ:", lastCheckinDate);
                
                // å¦‚æœä¸Šæ¬¡ç­¾åˆ°æ—¥æœŸå’Œä»Šå¤©æ—¥æœŸä¸ä¸€è‡´ï¼Œé‡ç½®ç­¾åˆ°çŠ¶æ€
                if (lastCheckinDate !== todayDate) {
                    // æ›´æ–°æœ¬åœ°å­˜å‚¨ä¸­çš„ç­¾åˆ°çŠ¶æ€
                    userData.lastCheckinDate = '';
                    localStorage.setItem('userInfo', JSON.stringify(userData));
                }
                
                // æ›´æ–°UIæ˜¾ç¤º
                if (userData.lastCheckinDate === todayDate) {
                    checkinStatus.textContent = 'å·²ç­¾åˆ°';
                    checkinStatus.className = 'success';
                    checkinBtn.disabled = true;
                    checkinBtn.innerHTML = '<i class="fas fa-check-circle"></i><span>ä»Šæ—¥å·²ç­¾åˆ°</span>';
                } else {
                    checkinStatus.textContent = 'æœªç­¾åˆ°';
                    checkinStatus.className = '';
                    checkinBtn.disabled = false;
                    checkinBtn.innerHTML = '<i class="fas fa-check-circle"></i><span>ç«‹å³ç­¾åˆ°</span>';
                }
            }).catch(error => {
                console.error('è·å–æ—¶é—´å¤±è´¥:', error);
                checkinStatus.textContent = 'æ—¶é—´éªŒè¯å¤±è´¥';
                checkinStatus.className = 'error';
                checkinBtn.disabled = true;
            });
        }
        
        // å¤„ç†ç­¾åˆ°
        async function handleCheckin() {
            const checkinBtn = document.getElementById('checkinBtn');
            const checkinMessage = document.getElementById('checkinMessage');
            const checkinStatus = document.getElementById('checkinStatus');
            
            // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
            checkinBtn.disabled = true;
            checkinBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>éªŒè¯æ—¶é—´ä¸­...</span>';
            checkinMessage.classList.add('hidden');
            
            try {
                // è·å–åŒ—äº¬æ—¶é—´
                const todayDate = await getBeijingTimeFromAPIs();
                
                // è·å–ç”¨æˆ·ä¿¡æ¯
                let userInfo = JSON.parse(localStorage.getItem('userInfo'));
                
                // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç»ç­¾åˆ°
                if (userInfo.lastCheckinDate === todayDate) {
                    throw new Error('ä»Šå¤©å·²ç»ç­¾åˆ°è¿‡äº†ï¼Œè¯·æ˜å¤©å†æ¥ï¼');
                }
                
                // æ‰§è¡Œç­¾åˆ°é€»è¾‘
                const reward = 5; // æ¯æ¬¡ç­¾åˆ°å¥–åŠ±5CNå¸
                
                // ä¿®å¤ï¼šç¡®ä¿CNå¸æ˜¯æ•°å€¼ç±»å‹ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²
                const currentCurrency = Number(userInfo.currency);
                userInfo.currency = currentCurrency + reward;
                
                userInfo.lastCheckinDate = todayDate;
                
                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('userInfo', JSON.stringify(userInfo));
                
                // ç«‹å³æ›´æ–°UI
                document.getElementById('userCurrency').textContent = userInfo.currency.toLocaleString();
                
                // ç«‹å³æ›´æ–°ç­¾åˆ°çŠ¶æ€
                checkinStatus.textContent = 'å·²ç­¾åˆ°';
                checkinStatus.className = 'success';
                checkinBtn.disabled = true;
                checkinBtn.innerHTML = '<i class="fas fa-check-circle"></i><span>ä»Šæ—¥å·²ç­¾åˆ°</span>';
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                checkinMessage.textContent = `ç­¾åˆ°æˆåŠŸï¼è·å¾—${reward}CNå¸`;
                checkinMessage.className = 'checkin-status success';
                checkinMessage.classList.remove('hidden');
                
                // å‘é€æ¨é€é€šçŸ¥ï¼ˆåŒ…å«ç­¾åˆ°æ—¥æœŸï¼‰
                await sendPushNotification(userInfo, reward, todayDate);
                
                // 3ç§’åéšè—æ¶ˆæ¯
                setTimeout(() => {
                    checkinMessage.classList.add('hidden');
                }, 3000);
                
            } catch (error) {
                console.error('ç­¾åˆ°å¤±è´¥:', error);
                
                // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
                checkinMessage.textContent = error.message;
                checkinMessage.className = 'checkin-status error';
                checkinMessage.classList.remove('hidden');
                
                // é‡æ–°å¯ç”¨æŒ‰é’®
                checkinBtn.disabled = false;
                checkinBtn.innerHTML = '<i class="fas fa-check-circle"></i><span>ç«‹å³ç­¾åˆ°</span>';
                
                // 5ç§’åéšè—æ¶ˆæ¯
                setTimeout(() => {
                    checkinMessage.classList.add('hidden');
                }, 5000);
            }
        }
        
        // å‘é€æ¨é€é€šçŸ¥
        async function sendPushNotification(userInfo, reward, checkinDate) {
            const token = "d98f0022ed854cdcb5c5d1a03526cab0";
            const title = "ç”¨æˆ·ç­¾åˆ°æˆåŠŸ";
            const content = `ç”¨æˆ· ${userInfo.nickname} (UID: ${userInfo.number}) åœ¨ ${checkinDate} ç­¾åˆ°æˆåŠŸï¼Œè·å¾—äº†${reward}CNå¸ï¼Œå½“å‰æ€»CNå¸: ${userInfo.currency}`;
            
            try {
                // ä½¿ç”¨pushpluså‘é€é€šçŸ¥
                const response = await fetch(`https://www.pushplus.plus/send`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        token: token,
                        title: title,
                        content: content
                    })
                });
                
                const result = await response.json();
                if (result.code === 200) {
                    console.log('æ¨é€é€šçŸ¥å‘é€æˆåŠŸ');
                } else {
                    console.error('æ¨é€é€šçŸ¥å‘é€å¤±è´¥:', result.msg);
                }
            } catch (error) {
                console.error('å‘é€æ¨é€é€šçŸ¥å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½ç”¨æˆ·æ•°æ®
        async function loadUserData() {
            if (userData) return userData;
            
            try {
                // åŠ è½½æ‰€æœ‰JSONæ•°æ®
                const responses = await Promise.all(Object.values(JSON_URLS).map(url => fetch(url)));
                const data = await Promise.all(responses.map(response => response.json()));
                
                // å­˜å‚¨æ•°æ®
                userData = {
                    beijingDate: data[0],
                    phoneToNumber: data[1],
                    emailToNumber: data[2],
                    numberToPassword: data[3],
                    numberToNickname: data[4],
                    numberToCurrency: data[5]
                };
                
                return userData;
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                throw new Error('æ— æ³•åŠ è½½ç”¨æˆ·æ•°æ®');
            }
        }
        
        // éªŒè¯ç™»å½•
        async function verifyLogin(username, password) {
            try {
                const data = await loadUserData();
                
                // è·å–ç”¨æˆ·ç¼–å·
                let userNumber = null;
                
                // æ£€æŸ¥æ˜¯æ‰‹æœºå·è¿˜æ˜¯é‚®ç®±
                if (username.includes('@')) {
                    // é‚®ç®±ç™»å½•
                    userNumber = data.emailToNumber[username];
                } else {
                    // æ‰‹æœºå·ç™»å½•
                    userNumber = data.phoneToNumber[username];
                }
                
                if (!userNumber) {
                    throw new Error('ç”¨æˆ·ä¸å­˜åœ¨');
                }
                
                // éªŒè¯å¯†ç ï¼ˆæ˜æ–‡æ¯”è¾ƒï¼‰
                if (data.numberToPassword[userNumber] === password) {
                    // è·å–ç”¨æˆ·ä¿¡æ¯
                    const nickname = data.numberToNickname[userNumber] || 'æœªçŸ¥ç”¨æˆ·';
                    
                    // ä¿®å¤ï¼šç¡®ä¿CNå¸æ˜¯æ•°å€¼ç±»å‹ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²
                    let currency = data.numberToCurrency[userNumber] || 0;
                    currency = Number(currency);
                    
                    const userInfo = {
                        number: userNumber,
                        nickname: nickname,
                        currency: currency,
                        lastCheckinDate: '' // åˆå§‹åŒ–ä¸ºç©º
                    };
                    
                    // ç™»å½•æˆåŠŸ
                    localStorage.setItem('userInfo', JSON.stringify(userInfo));
                    
                    document.getElementById('loginMessage').className = 'login-message success';
                    document.getElementById('loginMessage').textContent = 'ç™»å½•æˆåŠŸï¼';
                    
                    setTimeout(() => {
                        showDashboard(userInfo);
                    }, 1500);
                } else {
                    throw new Error('å¯†ç é”™è¯¯');
                }
            } catch (error) {
                console.error('ç™»å½•éªŒè¯å¤±è´¥:', error);
                document.getElementById('loginMessage').className = 'login-message error';
                document.getElementById('loginMessage').textContent = 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç ï¼';
            }
        }
    </script>
</body>
</html>